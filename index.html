<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    /* --- General Styles --- */
    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #fdfaf3, #e8f5e9);
      text-align: center;
      direction: rtl;
      padding: 0;
      margin: 0;
      color: #2e7d32;
      position: relative;
    }

    /* --- Scrolling Verses Bar --- */
    .verses-bar {
      background-color: #28a745;
      color: white;
      padding: 10px 0;
      overflow: hidden;
      white-space: nowrap;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      font-family: 'Amiri', serif;
      font-size: 18px;
      position: relative;
      height: 40px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù„Ø­Ø§ÙˆÙŠØ© */
    }
    .verse-quote {
      position: absolute;
      width: 100%;
      text-align: center;
      transform: translateX(100%); /* ØªØ¨Ø¯Ø£ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† */
      opacity: 0;
      transition: transform 1s ease-in-out, opacity 1s ease-in-out;
    }
    .verse-quote.active {
      transform: translateX(0); /* ØªØªØ­Ø±Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØµÙ */
      opacity: 1;
    }
    .verse-quote.exit {
      transform: translateX(-100%); /* ØªØ®Ø±Ø¬ Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
      opacity: 0;
    }

    /* --- Main Content Padding --- */
    .main-content {
        padding: 20px;
    }

    /* --- Help Button and Page --- */
    #instructionsBtn {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 999;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #4CAF50;
      color: white;
      border: 2px solid white;
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    #instructionsPage {
      display: none;
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.95);
      z-index: 1000;
      overflow-y: auto;
      padding: 40px 20px; /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø´ÙˆØ© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
      box-sizing: border-box;
      backdrop-filter: blur(5px);
    }
    #instructionsPage h2 { text-align: center; }
    #instructionsPage p { font-size: 18px; line-height: 1.6; }
    #instructionsPage button {
      margin-top: 20px;
      padding: 10px 20px; border-radius: 8px;
      background-color: #2196F3; color: white; border: none; cursor: pointer; font-weight: bold;
    }

    /* --- Quiz Box and General Elements --- */
    .quiz-box {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      padding: 30px;
      max-width: 600px;
      margin: 20px auto;
      border: 1px solid #d4b170;
    }
    h2 { font-size: 24px; margin-bottom: 20px; }
    input, select, button {
      width: 90%; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      border-radius: 10px;
      border: 2px solid #a5d6a7;
      font-family: 'Tajawal', sans-serif;
      box-sizing: border-box; /* Ù„Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„Ø­Ø´ÙˆØ© Ù„Ø§ ØªØ²ÙŠØ¯ Ø§Ù„Ø¹Ø±Ø¶ */
    }
    button {
        cursor: pointer;
        background-color: #2e7d32;
        color: white;
        font-weight: bold;
        transition: background-color 0.3s;
    }
    button:hover {
        background-color: #388e3c;
    }
    button.option-btn {
      display: block;
      background-color: #f1f8e9;
      border: 2px solid #4CAF50;
      color: #33691e;
      font-weight: bold;
      transition: 0.3s ease;
    }
    button.option-btn:hover { background-color: #dcedc8; }
    .correct { background-color: #c8e6c9 !important; border-color: #2e7d32; color: #2e7d32; }
    .wrong { background-color: #ffcdd2 !important; border-color: #c62828; color: #c62828; }

    /* --- Ayah Display Box --- */
    .islamic-pattern {
      background-color: #e8f5e9;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2395c297' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      border: 2px solid #a5d6a7;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      position: relative;
      overflow: hidden;
      margin-bottom: 20px;
      padding: 20px;
    }
    .ayah-decoration {
      font-family: 'Amiri', serif;
      font-size: 24px;
      line-height: 1.8;
      text-align: center;
      padding: 25px;
      color: #1b5e20;
      position: relative;
    }
    .ayah-decoration::before, .ayah-decoration::after {
      font-family: 'Amiri', serif;
      color: #2e7d32;
      font-size: 40px;
      position: absolute;
      opacity: 0.8;
    }
    .ayah-decoration::before { content: "ï´¿"; right: 15px; top: 15px; }
    .ayah-decoration::after { content: "ï´¾"; left: 15px; bottom: 15px; }

    /* --- Other Styles --- */
    .answer-feedback { font-size: 18px; font-weight: bold; margin: 15px 0; padding: 10px; border-radius: 8px; }
    .timer-container { font-size: 20px; color: #d32f2f; font-weight: bold; margin: 10px 0; padding: 10px; background-color: #ffebee; border-radius: 10px; }
    .progress-bar { height: 10px; background-color: #e0e0e0; border-radius: 5px; margin-top: 10px; overflow: hidden; }
    .progress { height: 100%; background-color: #4caf50; width: 100%; transition: width 1s linear; }
    .time-per-question { font-size: 14px; color: #666; margin-top: 5px; }
    .result-box { background-color: #f8f5ee; padding: 20px; border-radius: 15px; margin-top: 20px; }
    .corrections-box { margin-top: 20px; text-align: right; background-color: #fff9c4; padding: 15px; border-radius: 10px; }
    .correction-item { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #ccc; }
    .correction-question { font-weight: bold; color: #333; }
    .user-answer { color: #c62828; }
    .correct-answer { color: #2e7d32; }
    #orderMode { display: none; font-family: 'Amiri', serif; }
    .words-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; padding: 10px; background-color: #f0f8ff; border-radius: 8px; min-height: 40px; margin: 20px 0 15px 0; position: relative; z-index: 2; direction: rtl; }
    .drop-zone { background-color: #fff3e0; border: 2px dashed #d4af37; border-radius: 8px; padding: 20px; min-height: 100px; transition: all 0.3s; margin-bottom: 15px; font-size: 18px; line-height: 2; position: relative; z-index: 1; direction: rtl; text-align: right; }
    .drop-zone.highlight { background-color: #f5eef8; border-color: #8e44ad; }
    .word-btn { padding: 4px 8px; min-width: auto; width: auto; display: inline-flex; justify-content: center; border: none; background-color: transparent; box-shadow: none; color: #7d3c98; font-size: 18px; font-weight: 600; font-family: 'Amiri', 'Tajawal', sans-serif; border-radius: 3px; cursor: pointer; transition: all 0.2s; }
    .word-btn:hover { background-color: #f0e6ff; }
    .word-btn:active { opacity: 0.7; }
    .order-controls { display: flex; justify-content: center; gap: 5px; margin-top: 10px; }
    .order-control-btn { background-color: #8e44ad; color: white; border: none; padding: 12px; font-size: 18px; border-radius: 1px; cursor: pointer; transition: all 0.3s; flex: 1; min-width: 100px; }
    .order-control-btn:hover { background-color: #7d3c98; }
    .empty-message { color: #7f8c8d; font-style: italic; font-size: 16px; }
    .result-message { font-size: 18px; font-weight: bold; margin: 10px 0; color: #2c3e50; }
    .contact-box { background-color: #f5f5f5; padding: 20px; border-radius: 15px; margin-top: 30px; text-align: center; }
    .telegram-link { display: inline-flex; align-items: center; background-color: #0088cc; color: white; padding: 12px 20px; border-radius: 8px; text-decoration: none; font-weight: bold; margin-top: 10px; transition: all 0.3s; }
    .telegram-link:hover { background-color: #006699; }
    .telegram-link img { width: 24px; height: 24px; margin-left: 10px; }
    .welcome-message { background-color: #f5f5f5; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 16px; text-align: center; border: 1px solid #d4b170; }
    .welcome-title { font-weight: bold; color: #2e7d32; font-size: 18px; margin-bottom: 10px; }
    .welcome-text { line-height: 1.6; }
    #whichSurahMode { display: none; }
    #surahSelectorContainer { transition: all 0.3s ease; }
    .hidden { display: none !important; }
    .user-info-box { background: #f5f5f5; padding: 10px; border-radius: 10px; margin-bottom: 15px; }

    /* --- Responsive Design --- */
    @media (max-width: 768px) {
        .main-content {
            padding: 10px;
        }
        .quiz-box {
            padding: 20px;
            margin: 10px auto;
        }
        h2 {
            font-size: 20px;
        }
        .ayah-decoration {
            font-size: 20px; /* ØªØµØºÙŠØ± Ø®Ø· Ø§Ù„Ø¢ÙŠØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            padding: 20px 15px;
        }
        .ayah-decoration::before, .ayah-decoration::after {
            font-size: 30px; /* ØªØµØºÙŠØ± Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ */
        }
        input, select, button {
            width: 100%; /* Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ØªÙ…Ù„Ø£ Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
            font-size: 15px;
        }
        .verses-bar {
            font-size: 16px; /* ØªØµØºÙŠØ± Ø®Ø· Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        }
        #instructionsPage {
            padding: 30px 15px;
        }
        #instructionsPage p {
            font-size: 16px;
        }
    }

    @media (max-width: 480px) {
        .welcome-title {
            font-size: 16px;
        }
        .welcome-text {
            font-size: 14px;
        }
        .timer-container {
            font-size: 16px;
        }
        .time-per-question {
            font-size: 12px;
        }
        .word-btn {
            font-size: 16px; /* ØªØµØºÙŠØ± Ø®Ø· Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ±ØªÙŠØ¨ */
        }
        .drop-zone {
            font-size: 16px;
            padding: 15px;
        }
        .result-box p {
            font-size: 16px !important; /* Ø§Ø³ØªØ®Ø¯Ø§Ù… !important Ù„Ø¶Ù…Ø§Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†Ù…Ø· */
        }
        .result-box h2 {
            font-size: 18px;
        }
    }
</style>
</head>
<body>

<!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø±Ùƒ -->
<div class="verses-bar">
    <span class="verse-quote">"Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¢ØªÙÙŠÙ’Ù†ÙØ§Ù‡ÙÙ…Ù Ø§Ù„Ù’ÙƒÙØªÙØ§Ø¨Ù ÙŠÙØªÙ’Ù„ÙÙˆÙ†ÙÙ‡Ù Ø­ÙÙ‚Ù‘Ù ØªÙÙ„ÙØ§ÙˆÙØªÙÙ‡Ù"</span>
    <span class="verse-quote">"ÙˆÙØ±ÙØªÙ‘ÙÙ„Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù ØªÙØ±Ù’ØªÙÙŠÙ„Ù‹Ø§"</span>
    <span class="verse-quote">"Ø¥ÙÙ†Ù‘Ù Ù‡ÙÙ°Ø°ÙØ§ Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù ÙŠÙÙ‡Ù’Ø¯ÙÙŠ Ù„ÙÙ„Ù‘ÙØªÙÙŠ Ù‡ÙÙŠÙ Ø£ÙÙ‚Ù’ÙˆÙÙ…Ù"</span>
    <span class="verse-quote">"Ù„ÙÙˆÙ’ Ø£ÙÙ†Ø²ÙÙ„Ù’Ù†ÙØ§ Ù‡ÙÙ°Ø°ÙØ§ Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù Ø¹ÙÙ„ÙÙ‰Ù° Ø¬ÙØ¨ÙÙ„Ù Ù„Ù‘ÙØ±ÙØ£ÙÙŠÙ’ØªÙÙ‡Ù Ø®ÙØ§Ø´ÙØ¹Ù‹Ø§ Ù…Ù‘ÙØªÙØµÙØ¯Ù‘ÙØ¹Ù‹Ø§ Ù…Ù‘ÙÙ†Ù’ Ø®ÙØ´Ù’ÙŠÙØ©Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù"</span>
    <span class="verse-quote">"ÙˆÙÙ†ÙÙ†ÙØ²Ù‘ÙÙ„Ù Ù…ÙÙ†Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù Ù…ÙØ§ Ù‡ÙÙˆÙ Ø´ÙÙÙØ§Ø¡ÙŒ ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©ÙŒ Ù„Ù‘ÙÙ„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†ÙÙŠÙ†Ù"</span>
    <span class="verse-quote">"Ù‚ÙØ¯Ù’ Ø¬ÙØ§Ø¡ÙÙƒÙÙ… Ù…Ù‘ÙÙ†Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù†ÙÙˆØ±ÙŒ ÙˆÙÙƒÙØªÙØ§Ø¨ÙŒ Ù…Ù‘ÙØ¨ÙÙŠÙ†ÙŒ"</span>
    <span class="verse-quote">"ÙˆÙØ¥ÙØ°ÙØ§ Ù‚ÙØ±ÙØ¦Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù ÙÙØ§Ø³Ù’ØªÙÙ…ÙØ¹ÙÙˆØ§ Ù„ÙÙ‡Ù ÙˆÙØ£ÙÙ†ØµÙØªÙÙˆØ§ Ù„ÙØ¹ÙÙ„Ù‘ÙÙƒÙÙ…Ù’ ØªÙØ±Ù’Ø­ÙÙ…ÙÙˆÙ†Ù"</span>
    <span class="verse-quote">"ÙƒÙØªÙØ§Ø¨ÙŒ Ø£ÙÙ†Ø²ÙÙ„Ù’Ù†ÙØ§Ù‡Ù Ø¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ù…ÙØ¨ÙØ§Ø±ÙÙƒÙŒ Ù„Ù‘ÙÙŠÙØ¯Ù‘ÙØ¨Ù‘ÙØ±ÙÙˆØ§ Ø¢ÙŠÙØ§ØªÙÙ‡Ù ÙˆÙÙ„ÙÙŠÙØªÙØ°ÙÙƒÙ‘ÙØ±Ù Ø£ÙÙˆÙ„ÙÙˆ Ø§Ù„Ù’Ø£ÙÙ„Ù’Ø¨ÙØ§Ø¨Ù"</span>
    <span class="verse-quote">"ÙŠÙØ§ Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù Ù‚ÙØ¯Ù’ Ø¬ÙØ§Ø¡ÙØªÙ’ÙƒÙÙ… Ù…Ù‘ÙÙˆÙ’Ø¹ÙØ¸ÙØ©ÙŒ Ù…Ù‘ÙÙ† Ø±Ù‘ÙØ¨Ù‘ÙÙƒÙÙ…Ù’ ÙˆÙØ´ÙÙÙØ§Ø¡ÙŒ Ù„Ù‘ÙÙ…ÙØ§ ÙÙÙŠ Ø§Ù„ØµÙ‘ÙØ¯ÙÙˆØ±Ù"</span>
    <span class="verse-quote">"Ø¥ÙÙ†Ù‘Ù Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù ÙŠÙØªÙ’Ù„ÙÙˆÙ†Ù ÙƒÙØªÙØ§Ø¨Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ£ÙÙ‚ÙØ§Ù…ÙÙˆØ§ Ø§Ù„ØµÙ‘ÙÙ„ÙØ§Ø©Ù ÙˆÙØ£ÙÙ†ÙÙÙ‚ÙÙˆØ§ Ù…ÙÙ…Ù‘ÙØ§ Ø±ÙØ²ÙÙ‚Ù’Ù†ÙØ§Ù‡ÙÙ…Ù’ Ø³ÙØ±Ù‘Ù‹Ø§ ÙˆÙØ¹ÙÙ„ÙØ§Ù†ÙÙŠÙØ©Ù‹ ÙŠÙØ±Ù’Ø¬ÙÙˆÙ†Ù ØªÙØ¬ÙØ§Ø±ÙØ©Ù‹ Ù„Ù‘ÙÙ† ØªÙØ¨ÙÙˆØ±Ù"</span>
</div>

<div class="main-content">
    <!-- Ø²Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª -->
    <button id="instructionsBtn">ØŸ</button>
    <!-- ØµÙØ­Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª -->
    <div id="instructionsPage">
        <h2>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
        <p>Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡</p>
        <p>Ø§Ø®ØªØ¨Ø± Ø­ÙØ¸Ùƒ Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª ØªØ±ÙŠØ¯ ÙˆØ­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ø­ØªÙ‰ 25 Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ§Ø­Ø¯ Ø­ØªÙ‰ Ù„Ø§ ÙŠØªÙƒØ±Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ )</p>
        <p>Ø£Ù†ÙˆØ§Ø¹ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ§Ø­Ø¯:</p>
        <ol>
            <li>Ø£Ø³Ø¦Ù„Ø© Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ© : ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¢ÙŠØ© Ùˆ 4 Ø®ÙŠØ§Ø±Ø§Øª .</li>
            <li>Ø£Ø³Ø¦Ù„Ø© ØªÙƒÙ…Ù„Ø© Ø§Ù„Ø¢ÙŠØ© ÙˆÙ‡ÙŠ Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ø¢ÙŠØ© ÙˆÙŠÙˆØ¬Ø¯ ÙØ±Ø§ØºØ§Øª Ø¨Ù‡Ø§ ( Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 5 ÙƒÙ„Ù…Ø§Øª ).</li>
            <li>Ø£Ø³Ø¦Ù„Ø© Ù…Ø²ÙŠØ¬ Ø¨ÙŠÙ† Ø§Ù„Ù†ÙˆØ¹ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ† ØªÙØ¹Ø±Ø¶ Ù„Ù„Ù…Ø®ØªØ¨Ø± Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ.</li>
            <li>Ø£Ø³Ø¦Ù„Ø© Ø±ØªØ¨ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ØªÙØ¹Ø±Ø¶ Ø§Ù„Ø¢ÙŠØ§Øª (Ø§Ù„ØªÙŠ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ ÙƒÙ„Ù…Ø§ØªÙ‡Ø§ 12) ÙˆØ¹Ù„Ù‰ Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø³Ø­Ø¨Ù‡Ø§ ÙˆØ¥ÙÙ„Ø§ØªÙ‡Ø§ Ø¨Ø§Ù„Ù…ÙƒØ§Ù† ÙˆØ§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­.</li>
            <li>Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ù…Ù„Ø© ØªØ´Ù…Ù„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø«Ù„Ø§Ø«Ø© ( Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ© - Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¢ÙŠØ© - ØªØ±ØªÙŠØ¨ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ÙŠØ© ).</li>
            <li>Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø£ÙŠ Ø³ÙˆØ±Ø© ÙˆØ±Ø¯Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¢ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯).</li>
        </ol>
        <p>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù‚Ù†Ø§Ø© Ù†Ø´Ø± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØªØµØ­ÙŠØ­Ø§ØªÙ‡Ø§: https://t.me/qurantest2</p>
        <button id="backBtn">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div class="quiz-box" id="startForm">
        <div class="welcome-message">
            <div class="welcome-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
            <div class="welcome-text">
                Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªØ¨Ø§Ø± Ø­ÙØ¸Ùƒ Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… ÙˆØªÙ‚ÙˆÙŠØ© Ø­ÙØ¸Ùƒ Ù…Ù† Ø®Ù„Ø§Ù„ Ø£Ù†ÙˆØ§Ø¹ Ù…Ø®ØªÙ„ÙØ© Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.
                Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¢Ù†!
            </div>
        </div>
        <h2>Ø§Ø¨Ø¯Ø£ Ø§Ø®ØªØ¨Ø§Ø±Ùƒ</h2>
        <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
        <input type="number" id="questionCount" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 25)" min="1" max="25" value="" required />
        <select id="mode" required onchange="toggleSurahSelector()">
            <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± --</option>
            <option value="complete">Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¢ÙŠØ©</option>
            <option value="next">Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ</option>
            <option value="mixed">Ù…Ø²ÙŠØ¬ (Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¢ÙŠØ© + Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©)</option>
            <option value="order">ØªØ±ØªÙŠØ¨ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ÙŠØ©</option>
            <option value="whichsurah">ÙÙŠ Ø£ÙŠ Ø³ÙˆØ±Ø© ÙˆØ±Ø¯Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¢ÙŠØ©ØŸ</option>
            <option value="comprehensive">Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„</option>
        </select>
        <div id="surahSelectorContainer">
            <select id="surahSelector" required>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© --</option>
            </select>
        </div>
        <button onclick="startQuiz()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
    </div>

    <div class="quiz-box" id="quizBox" style="display: none;">
        <div class="user-info-box">
            <p style="margin: 5px 0;">
                <span style="font-weight: bold;">Ø§Ù„Ø§Ø³Ù…:</span>
                <span id="userNameDisplay">Ø²Ø§Ø¦Ø±</span>
            </p>
        </div>

        <div class="timer-container">
            <div id="timer">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 00:00</div>
            <div class="time-per-question" id="timePerQuestion">60 Ø«Ø§Ù†ÙŠØ© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„</div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
        </div>
        <div id="currentAyah" class="islamic-pattern">
            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
        </div>
        <div id="completeMode" style="display: none;">
            <input type="text" id="userAnswer" placeholder="Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¢ÙŠØ©..." autocomplete="off" />
            <button onclick="checkCompleteAnswer()">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
        </div>
        <div id="nextMode" style="display: none;">
            <div id="choices"></div>
        </div>
        <div id="orderMode" style="display: none;">
            <div class="words-container" id="wordsContainer"></div>
            <div class="drop-zone" id="dropZone">
                <p class="empty-message" id="emptyMessage">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù„ØªØ±ØªÙŠØ¨Ù‡Ø§</p>
                <div id="droppedWords"></div>
            </div>
            <div class="result-message" id="resultMessage"></div>
            <div class="order-controls">
                <button class="order-control-btn" id="checkBtn">ØªØ­Ù‚Ù‚</button>
            </div>
        </div>
        <div id="whichSurahMode" style="display: none;">
            <div id="whichSurahChoices"></div>
        </div>
        <p class="answer-feedback" id="feedback"></p>
    </div>
</div>
<script>
// --- START: Verse Scroller Logic ---
document.addEventListener('DOMContentLoaded', function() {
    const verses = document.querySelectorAll('.verses-bar .verse-quote');
    if (verses.length === 0) return; // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ù‹Ø§ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¢ÙŠØ§Øª

    let currentVerseIndex = 0;

    function showNextVerse() {
        const currentVerse = verses[currentVerseIndex];
        const nextVerseIndex = (currentVerseIndex + 1) % verses.length;
        const nextVerse = verses[nextVerseIndex];

        currentVerse.classList.add('exit');
        currentVerse.classList.remove('active');

        setTimeout(() => {
            nextVerse.classList.add('active');
        }, 100);

        setTimeout(() => {
            currentVerse.classList.remove('exit');
        }, 1100);

        currentVerseIndex = nextVerseIndex;
    }

    verses[currentVerseIndex].classList.add('active');
    setInterval(showNextVerse, 5000); // ØªØºÙŠÙŠØ± Ø§Ù„Ø¢ÙŠØ© ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù
});
// --- END: Verse Scroller Logic ---


// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
const TELEGRAM_BOT_TOKEN = '6671455687:AAHemRdgQbmodCsqeIaha55qfPml_h9cjVQ';
const TELEGRAM_CHANNEL_ID = '@quranmytest'; // Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
const TELEGRAM_SECOND_CHANNEL_ID = '@qurantest2'; // Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©

const sheetURLs = {
  complete: "https://opensheet.elk.sh/1opUbpiRngFk8tJVqt-jffAkr27kI9CwpAdd7QnOFsK4/complete",
  next: "https://opensheet.elk.sh/1opUbpiRngFk8tJVqt-jffAkr27kI9CwpAdd7QnOFsK4/next",
  order: "https://opensheet.elk.sh/1opUbpiRngFk8tJVqt-jffAkr27kI9CwpAdd7QnOFsK4/order",
  whichsurah: "https://opensheet.elk.sh/1opUbpiRngFk8tJVqt-jffAkr27kI9CwpAdd7QnOFsK4/whichsurah",
  results: 'https://sheet.best/api/sheets/2fb79a9a-4f21-483d-9446-3f0dc5fe9c7c/tabs/result',
  corrections: 'https://sheet.best/api/sheets/2fb79a9a-4f21-483d-9446-3f0dc5fe9c7c/tabs/corrections',
  counter: 'https://sheet.best/api/sheets/2fb79a9a-4f21-483d-9446-3f0dc5fe9c7c/tabs/counter'
};

const TIME_PER_QUESTION = 60;
const MAX_QUESTIONS = 25;
const TOTAL_SCORE = 100;

let questions = [];
let currentIndex = 0;
let score = 0;
let mode = "";
let username = "";
let selectedSurah = "";
let userAnswers = [];
let feedbackList = [];
let timer;
let totalSeconds = 0;
let remainingSeconds = 0;
let testStarted = false;
let corrections = [];
let draggedItem = null;
let correctOrder = [];
let userCounter = 0;

const surahOrder = [
  "Ø§Ù„ÙØ§ØªØ­Ø©", "Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†", "Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©", "Ø§Ù„Ø£Ù†Ø¹Ø§Ù…", "Ø§Ù„Ø£Ø¹Ø±Ø§Ù", "Ø§Ù„Ø£Ù†ÙØ§Ù„", "Ø§Ù„ØªÙˆØ¨Ø©", "ÙŠÙˆÙ†Ø³",
  "Ù‡ÙˆØ¯", "ÙŠÙˆØ³Ù", "Ø§Ù„Ø±Ø¹Ø¯", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ø§Ù„Ø­Ø¬Ø±", "Ø§Ù„Ù†Ø­Ù„", "Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡", "Ø§Ù„ÙƒÙ‡Ù", "Ù…Ø±ÙŠÙ…", "Ø·Ù‡", "Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡", "Ø§Ù„Ø­Ø¬",
  "Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†", "Ø§Ù„Ù†ÙˆØ±", "Ø§Ù„ÙØ±Ù‚Ø§Ù†", "Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡", "Ø§Ù„Ù†Ù…Ù„", "Ø§Ù„Ù‚ØµØµ", "Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª", "Ø§Ù„Ø±ÙˆÙ…", "Ù„Ù‚Ù…Ø§Ù†", "Ø§Ù„Ø³Ø¬Ø¯Ø©", "Ø§Ù„Ø£Ø­Ø²Ø§Ø¨",
  "Ø³Ø¨Ø£", "ÙØ§Ø·Ø±", "ÙŠØ³", "Ø§Ù„ØµØ§ÙØ§Øª", "Øµ", "Ø§Ù„Ø²Ù…Ø±", "ØºØ§ÙØ±", "ÙØµÙ„Øª", "Ø§Ù„Ø´ÙˆØ±Ù‰", "Ø§Ù„Ø²Ø®Ø±Ù", "Ø§Ù„Ø¯Ø®Ø§Ù†", "Ø§Ù„Ø¬Ø§Ø«ÙŠØ©", "Ø§Ù„Ø£Ø­Ù‚Ø§Ù",
  "Ù…Ø­Ù…Ø¯", "Ø§Ù„ÙØªØ­", "Ø§Ù„Ø­Ø¬Ø±Ø§Øª", "Ù‚", "Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª", "Ø§Ù„Ø·ÙˆØ±", "Ø§Ù„Ù†Ø¬Ù…", "Ø§Ù„Ù‚Ù…Ø±", "Ø§Ù„Ø±Ø­Ù…Ù†", "Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©", "Ø§Ù„Ø­Ø¯ÙŠØ¯", "Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©",
  "Ø§Ù„Ø­Ø´Ø±", "Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©", "Ø§Ù„ØµÙ", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†", "Ø§Ù„ØªØºØ§Ø¨Ù†", "Ø§Ù„Ø·Ù„Ø§Ù‚", "Ø§Ù„ØªØ­Ø±ÙŠÙ…", "Ø§Ù„Ù…Ù„Ùƒ", "Ø§Ù„Ù‚Ù„Ù…", "Ø§Ù„Ø­Ø§Ù‚Ø©",
  "Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬", "Ù†ÙˆØ­", "Ø§Ù„Ø¬Ù†", "Ø§Ù„Ù…Ø²Ù…Ù„", "Ø§Ù„Ù…Ø¯Ø«Ø±", "Ø§Ù„Ù‚ÙŠØ§Ù…Ø©", "Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", "Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª", "Ø§Ù„Ù†Ø¨Ø£", "Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª", "Ø¹Ø¨Ø³",
  "Ø§Ù„ØªÙƒÙˆÙŠØ±", "Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±", "Ø§Ù„Ù…Ø·ÙÙÙŠÙ†", "Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚", "Ø§Ù„Ø¨Ø±ÙˆØ¬", "Ø§Ù„Ø·Ø§Ø±Ù‚", "Ø§Ù„Ø£Ø¹Ù„Ù‰", "Ø§Ù„ØºØ§Ø´ÙŠØ©", "Ø§Ù„ÙØ¬Ø±", "Ø§Ù„Ø¨Ù„Ø¯",
  "Ø§Ù„Ø´Ù…Ø³", "Ø§Ù„Ù„ÙŠÙ„", "Ø§Ù„Ø¶Ø­Ù‰", "Ø§Ù„Ø´Ø±Ø­", "Ø§Ù„ØªÙŠÙ†", "Ø§Ù„Ø¹Ù„Ù‚", "Ø§Ù„Ù‚Ø¯Ø±", "Ø§Ù„Ø¨ÙŠÙ†Ø©", "Ø§Ù„Ø²Ù„Ø²Ù„Ø©", "Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª", "Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©",
  "Ø§Ù„ØªÙƒØ§Ø«Ø±", "Ø§Ù„Ø¹ØµØ±", "Ø§Ù„Ù‡Ù…Ø²Ø©", "Ø§Ù„ÙÙŠÙ„", "Ù‚Ø±ÙŠØ´", "Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†", "Ø§Ù„ÙƒÙˆØ«Ø±", "Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†", "Ø§Ù„Ù†ØµØ±", "Ø§Ù„Ù…Ø³Ø¯", "Ø§Ù„Ø¥Ø®Ù„Ø§Øµ",
  "Ø§Ù„ÙÙ„Ù‚", "Ø§Ù„Ù†Ø§Ø³"
];

// Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
async function sendTelegramMessage(text, chatId = TELEGRAM_CHANNEL_ID) {
  try {
    const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: chatId,
        text: text,
        parse_mode: 'HTML'
      })
    });
    return await response.json();
  } catch (error) {
    console.error('Error sending to Telegram:', error);
    return null;
  }
}

// Ø¯Ø§Ù„Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¨Ø¯Ø¡
async function incrementCounter() {
  userCounter++;
  
  const now = new Date();
  const dateTime = now.toLocaleString('ar-EG', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
  
  const startMessage = `
ğŸ“Š <b>Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</b>
ğŸ‘¤ <b>Ø§Ù„Ø§Ø³Ù…:</b> ${username || "Ø²Ø§Ø¦Ø±"}
ğŸ“… <b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${dateTime}
ğŸ”¢ <b>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</b> ${document.getElementById("questionCount").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}
ğŸ“ <b>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</b> ${getModeName(mode)}
ğŸ“– <b>Ø§Ù„Ø³ÙˆØ±Ø©:</b> ${selectedSurah === "__all__" ? "ÙƒÙ„ Ø§Ù„Ø³ÙˆØ±" : selectedSurah}
  `;
  
  await sendTelegramMessage(startMessage, TELEGRAM_CHANNEL_ID);
}
// Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
async function sendFinalReport() {
  const percentage = Math.round((score / questions.length) * 100);
  const roundedScore = Math.round((100 / questions.length) * score);
  const now = new Date();
  
  const dateTime = now.toLocaleString('ar-EG', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  })

  let resultMessage = "";
  if (percentage >= 90) resultMessage = "Ù…Ù…ØªØ§Ø²! Ø­ÙØ¸Ùƒ Ø±Ø§Ø¦Ø¹ Ø¬Ø¯Ø§Ù‹";
  else if (percentage >= 70) resultMessage = "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! ÙˆØ§ØµÙ„ Ø§Ù„ØªÙ‚Ø¯Ù…";
  else if (percentage >= 50) resultMessage = "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡";
  else resultMessage = "ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©";

  // Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (@quranmytest)
  const basicReport = `
ğŸ“ <b>ØªÙ‚Ø±ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</b>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
<strong>${resultMessage}</strong>
ğŸ‘¤ <b>Ø§Ù„Ø§Ø³Ù…:</b> ${username || "Ø²Ø§Ø¦Ø±"}
ğŸ“… <b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${dateTime}
ğŸ“Š <b>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</b> ${getModeName(mode)}
${selectedSurah && selectedSurah !== "__all__" ? `ğŸ“– <b>Ø§Ù„Ø³ÙˆØ±Ø©:</b> ${selectedSurah}\n` : ''}
ğŸ“Œ <b>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</b> ${questions.length}
âœ… <b>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©:</b> ${score}
âŒ <b>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©:</b> ${questions.length - score}
ğŸ“ˆ <b>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©:</b> ${percentage}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  `;

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
  await sendTelegramMessage(basicReport, TELEGRAM_CHANNEL_ID);

  // Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„ Ù„Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (qurantest2) - ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø£Ø®Ø·Ø§Ø¡
  if (corrections.length > 0) {
    let detailedReport = `
ğŸ“ <b>ØªÙ‚Ø±ÙŠØ± ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</b>
ğŸ‘¤ <b>Ø§Ù„Ø§Ø³Ù…:</b> ${username || "Ø²Ø§Ø¦Ø±"}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š <b>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</b> ${getModeName(mode)}
${selectedSurah && selectedSurah !== "__all__" ? `ğŸ“– <b>Ø§Ù„Ø³ÙˆØ±Ø©:</b> ${selectedSurah}\n` : ''}
ğŸ“ˆ <b>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</b> ${roundedScore}/100
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ <b>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:</b>
`;

    corrections.forEach((correction, index) => {
      detailedReport += `
<blockquote>
âšªï¸ <b>Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}:</b> ${correction.question}
- - - - -
âŒ <b>Ø¥Ø¬Ø§Ø¨ØªÙƒ:</b> <i>${correction.userAnswer}</i>
âœ… <b>Ø§Ù„ØµØ­ÙŠØ­Ø©:</b> <b>${correction.correctAnswer}</b>
</blockquote>
`;
    });

    detailedReport += `
ğŸ“¢ <b>Ù…Ù„Ø§Ø­Ø¸Ø©:</b>
ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¦Ùƒ ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.
Ø´Ø§Ø±Ùƒ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ: https://usamekesmo.github.io/Qurantest/
`;

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„
    await sendTelegramMessage(detailedReport, TELEGRAM_SECOND_CHANNEL_ID);
  }
}
function toggleSurahSelector() {
  const modeVal = document.getElementById("mode").value;
  const surahSelectorContainer = document.getElementById("surahSelectorContainer");
  if (modeVal === "whichsurah") {
    surahSelectorContainer.classList.add("hidden");
  } else {
    surahSelectorContainer.classList.remove("hidden");
  }
}

function shuffleArray(array) {
  return array.sort(() => Math.random() - 0.5);
}

function fetchCounter() {
  // This function is a placeholder.
}

function startTimer() {
  updateTimerDisplay();
  timer = setInterval(() => {
    remainingSeconds--;
    updateTimerDisplay();
    if (remainingSeconds <= 0) {
      endTest();
    }
  }, 1000);
}

function updateTimerDisplay() {
  const minutes = Math.floor(remainingSeconds / 60);
  const seconds = remainingSeconds % 60;
  const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  document.getElementById("timer").textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${formattedTime}`;
  const progressPercent = (remainingSeconds / totalSeconds) * 100;
  document.getElementById("progress").style.width = `${progressPercent}%`;
  if (progressPercent < 20) {
    document.getElementById("progress").style.backgroundColor = "#f44336";
  } else if (progressPercent < 50) {
    document.getElementById("progress").style.backgroundColor = "#ff9800";
  } else {
    document.getElementById("progress").style.backgroundColor = "#4caf50";
  }
}

function endTest() {
  clearInterval(timer);
  showFinalResults();
}

function showFinalResults() {
  clearInterval(timer);
  
  sendFinalReport();
  
  const percentage = Math.round((score / questions.length) * 100);
  const roundedScore = Math.round((TOTAL_SCORE / questions.length) * score);
  let resultMessage = "";
  if (percentage >= 90) resultMessage = "Ù…Ù…ØªØ§Ø²! Ø­ÙØ¸Ùƒ Ø±Ø§Ø¦Ø¹ Ø¬Ø¯Ø§Ù‹";
  else if (percentage >= 70) resultMessage = "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! ÙˆØ§ØµÙ„ Ø§Ù„ØªÙ‚Ø¯Ù…";
  else if (percentage >= 50) resultMessage = "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡";
  else resultMessage = "ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©";

  let reviewItems = "";
  questions.forEach((q, index) => {
    const userAnswer = userAnswers[index] || "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©";
    let questionText = "";
    let correctAnswerText = "";

    if (q.hasOwnProperty('surahname')) {
        questionText = `ÙÙŠ Ø£ÙŠ Ø³ÙˆØ±Ø© ÙˆØ±Ø¯Øª Ø§Ù„Ø¢ÙŠØ©: ${q.aya}`;
        correctAnswerText = q.surahname;
    } else if (q.hasOwnProperty('ayacomplete')) {
        questionText = `Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¢ÙŠØ©: ${q.ayacomplete} ...`;
        correctAnswerText = q.correct;
    } else if (q.hasOwnProperty('ayanext')) {
        questionText = `Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù€: ${q.ayanext}`;
        correctAnswerText = q['option' + q['correct option number']];
    } else if (q.hasOwnProperty('k1')) {
        questionText = `Ø±ØªØ¨ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ÙŠØ© Ù…Ù† Ø³ÙˆØ±Ø© ${q.surah}`;
        const correctOrderArr = [];
        for (let i = 1; i <= 12; i++) {
            if (q[`k${i}`]) correctOrderArr.push(q[`k${i}`].trim());
        }
        correctAnswerText = correctOrderArr.join(' ');
    }

    reviewItems += `
      <div class="correction-item">
        <div class="correction-question">Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}: ${questionText}</div>
        <div><span class="answer-label">Ø¥Ø¬Ø§Ø¨ØªÙƒ:</span> <span class="user-answer">${userAnswer}</span></div>
        <div><span class="answer-label">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</span> <span class="correct-answer">${correctAnswerText}</span></div>
      </div>
    `;
  });

  const resultHTML = `
    <div id="printable-result">
      <h2>Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h2>
      <div class="result-box">
        <p style="font-size: 24px; color: #2e7d32;">${resultMessage}</p>
        <p><strong>${username || 'Ø²Ø§Ø¦Ø±'}</strong></p>
        <p>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <strong>${roundedScore}/${TOTAL_SCORE}</strong></p>
        <p>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©: <strong>${score}/${questions.length}</strong></p>
        <p>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©: <strong>${percentage}%</strong></p>
        <p>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: <strong>${getModeName(mode)}</strong></p>
        ${selectedSurah && selectedSurah !== "__all__" ? `<p>Ø§Ù„Ø³ÙˆØ±Ø©: <strong>${selectedSurah}</strong></p>` : ''}
        <div class="contact-box">
          <h3>Ù„Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª</h3>
          <p>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù‚Ù†Ø§ØªÙ†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…:</p>
          <a href="https://t.me/qurantest2" target="_blank" class="telegram-link">
            <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram">
            t.me/qurantest2
          </a>
        </div>
        <div class="corrections-box">
          <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª:</h3>
          ${reviewItems}
        </div>
      </div>
    </div>
  `;
  document.getElementById("quizBox").innerHTML = resultHTML;
  storeResultInSheet();
}

function getModeName(mode) {
  const modes = {
    'complete': 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¢ÙŠØ©',
    'next': 'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ',
    'mixed': 'Ù…Ø²ÙŠØ¬ (Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¢ÙŠØ© + Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©)',
    'order': 'ØªØ±ØªÙŠØ¨ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ÙŠØ©',
    'whichsurah': 'ÙÙŠ Ø£ÙŠ Ø³ÙˆØ±Ø© ÙˆØ±Ø¯Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¢ÙŠØ©ØŸ',
    'comprehensive': 'Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„'
  };
  return modes[mode] || mode;
}

function loadSurahs() {
  fetch(sheetURLs.complete)
    .then(res => res.json())
    .then(data => {
      const uniqueSurahs = [...new Set(data.map(q => q.surah?.trim()).filter(Boolean))];
      const sortedSurahs = surahOrder.filter(s => uniqueSurahs.includes(s));
      const select = document.getElementById("surahSelector");
      const allOption = document.createElement("option");
      allOption.value = "__all__";
      allOption.textContent = "ÙƒÙ„ Ø§Ù„Ø³ÙˆØ±";
      select.appendChild(allOption);
      sortedSurahs.forEach(surah => {
        const option = document.createElement("option");
        option.value = surah;
        option.textContent = surah;
        select.appendChild(option);
      });
    });
}

function startQuiz() {
  username = document.getElementById("username").value.trim();
  mode = document.getElementById("mode").value;
  selectedSurah = document.getElementById("surahSelector").value;
  const questionCount = parseInt(document.getElementById("questionCount").value) || 10;

  if (!mode) {
    alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±");
    return;
  }

  if (mode !== "whichsurah" && (!selectedSurah || selectedSurah === "")) {
    alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©");
    return;
  }

  document.getElementById("userNameDisplay").textContent = username || "Ø²Ø§Ø¦Ø±";
  incrementCounter();

  currentIndex = 0;
  score = 0;
  questions = [];
  userAnswers = [];
  corrections = [];
  totalSeconds = Math.min(questionCount, MAX_QUESTIONS) * TIME_PER_QUESTION;
  remainingSeconds = totalSeconds;

  document.getElementById("timePerQuestion").textContent = 
    `${TIME_PER_QUESTION} Ø«Ø§Ù†ÙŠØ© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ (Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙƒÙ„ÙŠ: ${Math.floor(totalSeconds/60)}:${(totalSeconds%60).toString().padStart(2, '0')})`;

  document.getElementById("startForm").style.display = "none";
  document.getElementById("quizBox").style.display = "block";

  const urlsToFetch = [];
  if (mode === 'mixed' || mode === 'comprehensive') {
      urlsToFetch.push(fetch(sheetURLs.complete).then(res => res.json()));
      urlsToFetch.push(fetch(sheetURLs.next).then(res => res.json()));
      urlsToFetch.push(fetch(sheetURLs.order).then(res => res.json()));
      if (mode === 'comprehensive') {
          urlsToFetch.push(fetch(sheetURLs.whichsurah).then(res => res.json()));
      }
  } else {
      urlsToFetch.push(fetch(sheetURLs[mode]).then(res => res.json()));
  }

  Promise.all(urlsToFetch).then(allData => {
      let allQuestions = [];
      if (mode === 'comprehensive') {
          const [completeData, nextData, orderData, whichSurahData] = allData;
          let fComplete = selectedSurah === '__all__' ? completeData : completeData.filter(q => q.surah?.trim() === selectedSurah);
          let fNext = selectedSurah === '__all__' ? nextData : nextData.filter(q => q.surah?.trim() === selectedSurah);
          let fOrder = selectedSurah === '__all__' ? orderData : orderData.filter(q => q.surah?.trim() === selectedSurah);
          allQuestions = [...fComplete, ...fNext, ...fOrder, ...whichSurahData];
      } else if (mode === 'mixed') {
          const [completeData, nextData, orderData] = allData;
          let fComplete = selectedSurah === '__all__' ? completeData : completeData.filter(q => q.surah?.trim() === selectedSurah);
          let fNext = selectedSurah === '__all__' ? nextData : nextData.filter(q => q.surah?.trim() === selectedSurah);
          let fOrder = selectedSurah === '__all__' ? orderData : orderData.filter(q => q.surah?.trim() === selectedSurah);
          allQuestions = [...fComplete, ...fNext, ...fOrder];
      } else {
          let data = allData[0];
          allQuestions = (selectedSurah && selectedSurah !== '__all__') ? data.filter(q => q.surah?.trim() === selectedSurah) : data;
      }
      
      questions = shuffleArray(allQuestions).slice(0, Math.min(questionCount, MAX_QUESTIONS));
      startTimer();
      showQuestion();
  });
}

function showQuestion() {
  document.getElementById('feedback').innerText = "";
  if (currentIndex >= questions.length) {
    endTest();
    return;
  }

  const q = questions[currentIndex];
  const questionType = q.hasOwnProperty('ayacomplete') ? 'complete' :
                       q.hasOwnProperty('ayanext') ? 'next' :
                       q.hasOwnProperty('k1') ? 'order' : 'whichsurah';

  document.getElementById("completeMode").style.display = questionType === 'complete' ? 'block' : 'none';
  document.getElementById("nextMode").style.display = questionType === 'next' ? 'block' : 'none';
  document.getElementById("orderMode").style.display = questionType === 'order' ? 'block' : 'none';
  document.getElementById("whichSurahMode").style.display = questionType === 'whichsurah' ? 'block' : 'none';

  let questionHTML = '';
  switch (questionType) {
      case 'complete':
          questionHTML = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentIndex + 1}: ${q.ayacomplete} ...`;
          document.getElementById("userAnswer").value = "";
          break;
      case 'next':
          questionHTML = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentIndex + 1}: ${q.ayanext}`;
          const choices = shuffleArray([q.option1, q.option2, q.option3, q.option4]);
          const choicesContainer = document.getElementById("choices");
          choicesContainer.innerHTML = "";
          choices.forEach(choice => {
              const btn = document.createElement("button");
              btn.className = "option-btn";
              btn.innerText = choice;
              btn.onclick = () => checkNextAnswer(choice, q['option' + q['correct option number']], btn);
              choicesContainer.appendChild(btn);
          });
          break;
      case 'order':
          questionHTML = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentIndex + 1}: Ø±ØªØ¨ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ÙŠØ© Ù…Ù† Ø³ÙˆØ±Ø© ${q.surah}`;
          setupOrderQuestion(q);
          break;
      case 'whichsurah':
          questionHTML = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentIndex + 1}: ÙÙŠ Ø£ÙŠ Ø³ÙˆØ±Ø© ÙˆØ±Ø¯Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¢ÙŠØ©ØŸ<p style="font-size: 20px; margin-top: 10px;">${q.aya}</p>`;
          const surahChoices = shuffleArray([q.surahname, q.option2, q.option3, q.option4]);
          const surahChoicesContainer = document.getElementById("whichSurahChoices");
          surahChoicesContainer.innerHTML = "";
          surahChoices.forEach(choice => {
              const btn = document.createElement("button");
              btn.className = "option-btn";
              btn.innerText = choice;
              btn.onclick = () => checkWhichSurahAnswer(choice, q.surahname, btn);
              surahChoicesContainer.appendChild(btn);
          });
          break;
  }
  document.getElementById("currentAyah").innerHTML = `<div class="ayah-decoration">${questionHTML}</div>`;
}

function setupOrderQuestion(q) {
  correctOrder = [];
  for (let i = 1; i <= 12; i++) {
    if (q[`k${i}`]) correctOrder.push(q[`k${i}`].trim());
  }
  const shuffledWords = shuffleArray([...correctOrder]);
  const wordsContainer = document.getElementById("wordsContainer");
  wordsContainer.innerHTML = '';
  shuffledWords.forEach(word => {
    const wordBtn = document.createElement('button');
    wordBtn.className = 'word-btn';
    wordBtn.textContent = word;
    wordBtn.onclick = () => handleWordClick(wordBtn);
    wordsContainer.appendChild(wordBtn);
  });

  document.getElementById("droppedWords").innerHTML = '';
  document.getElementById("emptyMessage").style.display = 'block';
  document.getElementById("resultMessage").textContent = '';

  document.getElementById("checkBtn").onclick = () => {
    const userOrder = Array.from(document.getElementById("droppedWords").children).map(el => el.textContent);
    const isCorrect = JSON.stringify(userOrder) === JSON.stringify(correctOrder);
    handleAnswer(isCorrect, userOrder.join(' '), correctOrder.join(' '));
  };
}

function handleWordClick(wordBtn) {
  const droppedWords = document.getElementById("droppedWords");
  const wordsContainer = document.getElementById("wordsContainer");
  if (wordBtn.parentElement === wordsContainer) {
    droppedWords.appendChild(wordBtn);
  } else {
    wordsContainer.appendChild(wordBtn);
  }
  document.getElementById("emptyMessage").style.display = droppedWords.children.length === 0 ? 'block' : 'none';
}

function checkCompleteAnswer() {
  const q = questions[currentIndex];
  const userAnswer = document.getElementById("userAnswer").value.trim();
  const correctAnswer = q.correct.trim();
  const normalizedUser = userAnswer.replace(/[.,ØŒ]/g, '').replace(/\s+/g, ' ').trim();
  const normalizedCorrect = correctAnswer.replace(/[.,ØŒ]/g, '').replace(/\s+/g, ' ').trim();
  handleAnswer(normalizedUser === normalizedCorrect, userAnswer, correctAnswer);
}

function checkNextAnswer(selected, correct, button) {
  handleAnswer(selected === correct, selected, correct, button);
}

function checkWhichSurahAnswer(selected, correct, button) {
  handleAnswer(selected === correct, selected, correct, button);
}

function handleAnswer(isCorrect, userAnswer, correctAnswer, button = null) {
  userAnswers[currentIndex] = userAnswer;
  const feedbackEl = document.getElementById("feedback");

  if (isCorrect) {
    score++;
    feedbackEl.innerText = "âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!";
    feedbackEl.className = "answer-feedback correct";
    if (button) button.classList.add("correct");
  } else {
    feedbackEl.innerText = `âŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctAnswer}`;
    feedbackEl.className = "answer-feedback wrong";
    if (button) button.classList.add("wrong");
    
    const q = questions[currentIndex];
    let questionText = "";
    if (q.hasOwnProperty('ayacomplete')) questionText = `Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¢ÙŠØ©: ${q.ayacomplete} ...`;
    else if (q.hasOwnProperty('ayanext')) questionText = `Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù€: ${q.ayanext}`;
    else if (q.hasOwnProperty('k1')) questionText = `Ø±ØªØ¨ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ÙŠØ© Ù…Ù† Ø³ÙˆØ±Ø© ${q.surah}`;
    else if (q.hasOwnProperty('aya')) questionText = `ÙÙŠ Ø£ÙŠ Ø³ÙˆØ±Ø© ÙˆØ±Ø¯Øª Ø§Ù„Ø¢ÙŠØ©: ${q.aya}`;

    corrections.push({
      question: questionText,
      userAnswer: userAnswer,
      correctAnswer: correctAnswer
    });
  }

  // Disable further interaction
  const buttons = document.querySelectorAll('#choices button, #whichSurahChoices button, #checkBtn');
  buttons.forEach(btn => btn.disabled = true);
  document.getElementById('userAnswer').disabled = true;

  setTimeout(() => {
    currentIndex++;
    showQuestion();
    // Re-enable for next question
    buttons.forEach(btn => btn.disabled = false);
    document.getElementById('userAnswer').disabled = false;
  }, 2000);
}

function storeResultInSheet() {
  const data = {
    date: new Date().toLocaleString('ar-EG'),
    username: username || 'Ø²Ø§Ø¦Ø±',
    mode: getModeName(mode),
    surah: selectedSurah === "__all__" ? "ÙƒÙ„ Ø§Ù„Ø³ÙˆØ±" : selectedSurah,
    questioncount: questions.length,
    score: Math.round((TOTAL_SCORE / questions.length) * score),
    correctCount: score,
    wrongCount: questions.length - score
  };
  fetch(sheetURLs.results, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  }).catch(e => console.error('Failed to store result:', e));
}

window.onload = function() {
  loadSurahs();
  fetchCounter();

  document.getElementById('instructionsBtn').onclick = function() {
    document.getElementById('instructionsPage').style.display = 'block';
  };
  document.getElementById('backBtn').onclick = function() {
    document.getElementById('instructionsPage').style.display = 'none';
  };
};
</script>
</body>
</html>
